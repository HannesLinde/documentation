
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Routing system Â· Livingdocs Technical Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Livingdocs">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../concepts/metadata/metadata-examples.html" />
    
    
    <link rel="prev" href="../server-extensions/publish-hooks.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../getting_started.html">
            
                <a href="../../getting_started.html">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../walkthroughs/getting-started-with-local-development.html">
            
                <a href="../../walkthroughs/getting-started-with-local-development.html">
            
                    
                    Setting up Livingdocs locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../GLOSSARY.html">
            
                <a href="../../GLOSSARY.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Livingdocs Design</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../common-designs/create_designs.html">
            
                <a href="../common-designs/create_designs.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../common-designs/component_config.html">
            
                <a href="../common-designs/component_config.html">
            
                    
                    Livingdocs components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../common-designs/design_config.html">
            
                <a href="../common-designs/design_config.html">
            
                    
                    Design configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../common-designs/list_example.html">
            
                <a href="../common-designs/list_example.html">
            
                    
                    Bullet List
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../concepts/document-migrations/migrations.html">
            
                <a href="../../concepts/document-migrations/migrations.html">
            
                    
                    Design migrations
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Livingdocs Customizations</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../walkthroughs/add_customizations.html">
            
                <a href="../../walkthroughs/add_customizations.html">
            
                    
                    Register customizations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    Editor
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../editor-configuration/metadata.html">
            
                <a href="../editor-configuration/metadata.html">
            
                    
                    Metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../editor-configuration/search-filters.html">
            
                <a href="../editor-configuration/search-filters.html">
            
                    
                    Dashboard search filters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../editor-configuration/text-editing.html">
            
                <a href="../editor-configuration/text-editing.html">
            
                    
                    Cofigure text editing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../editor-configuration/image-cropping.html">
            
                <a href="../editor-configuration/image-cropping.html">
            
                    
                    Configure image cropping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="../editor-configuration/editing-features.html">
            
                <a href="../editor-configuration/editing-features.html">
            
                    
                    Configure editing features
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                    Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../server-configuration/metadata.html">
            
                <a href="../server-configuration/metadata.html">
            
                    
                    Metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../server-extensions/add-custom-include.html">
            
                <a href="../server-extensions/add-custom-include.html">
            
                    
                    Adding Includes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../server-extensions/events.html">
            
                <a href="../server-extensions/events.html">
            
                    
                    Available Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../server-configuration/config.html">
            
                <a href="../server-configuration/config.html">
            
                    
                    Configure the server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../server-configuration/channel-config.html">
            
                <a href="../server-configuration/channel-config.html">
            
                    
                    Configure channels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.6" data-path="../server-extensions/publish-hooks.html">
            
                <a href="../server-extensions/publish-hooks.html">
            
                    
                    Publish and Unpublish Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.3.7" data-path="routing-system.html">
            
                <a href="routing-system.html">
            
                    
                    Routing system
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../concepts/metadata/metadata-examples.html">
            
                <a href="../../concepts/metadata/metadata-examples.html">
            
                    
                    Metadata Example (editor and server)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../server-print-api/print-api.html">
            
                <a href="../server-print-api/print-api.html">
            
                    
                    Print API
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Devops</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../setup-and-deployment/self-hosting.html">
            
                <a href="../../setup-and-deployment/self-hosting.html">
            
                    
                    Hosting Livingdocs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../setup-and-deployment/hardware-requirements.html">
            
                <a href="../../setup-and-deployment/hardware-requirements.html">
            
                    
                    Hardware Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../setup-and-deployment/high-availability/">
            
                <a href="../../setup-and-deployment/high-availability/">
            
                    
                    Architecture
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.2.1" data-path="../../setup-and-deployment/high-availability/high-availability-setup.html">
            
                <a href="../../setup-and-deployment/high-availability/high-availability-setup.html">
            
                    
                    high-availability
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../../setup-and-deployment/docker/">
            
                <a href="../../setup-and-deployment/docker/">
            
                    
                    Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.3.1" data-path="../../setup-and-deployment/docker/build-docker-images.html">
            
                <a href="../../setup-and-deployment/docker/build-docker-images.html">
            
                    
                    Build docker images
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="../../setup-and-deployment/external-services.html">
            
                <a href="../../setup-and-deployment/external-services.html">
            
                    
                    External services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="../../setup-and-deployment/proxy.html">
            
                <a href="../../setup-and-deployment/proxy.html">
            
                    
                    Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="../../setup-and-deployment/npm/access-private-npm-modules.html">
            
                <a href="../../setup-and-deployment/npm/access-private-npm-modules.html">
            
                    
                    NPM Tokens
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../server-configuration/design-servers.html">
            
                <a href="../server-configuration/design-servers.html">
            
                    
                    Design Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../maintenance/how-to-do-a-load-test.html">
            
                <a href="../maintenance/how-to-do-a-load-test.html">
            
                    
                    Load Testing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Administration</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../walkthroughs/create-users.html">
            
                <a href="../../walkthroughs/create-users.html">
            
                    
                    Create Users
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../server-configuration/logging.html">
            
                <a href="../server-configuration/logging.html">
            
                    
                    Logs
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Livingdocs core development</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    Editor
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../editor-styleguide/styleguide.html">
            
                <a href="../editor-styleguide/styleguide.html">
            
                    
                    Styleguide
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <span>
            
                    
                    Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.2.1" data-path="../server-editing-api/">
            
                <a href="../server-editing-api/">
            
                    
                    Editing API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.2.1.1" data-path="../server-editing-api/api_basics.html">
            
                <a href="../server-editing-api/api_basics.html">
            
                    
                    Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.2" data-path="../server-editing-api/api_cors.html">
            
                <a href="../server-editing-api/api_cors.html">
            
                    
                    CORS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.3" data-path="../server-editing-api/api_errors.html">
            
                <a href="../server-editing-api/api_errors.html">
            
                    
                    Error
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.4" data-path="../server-editing-api/editing_api_authentication.html">
            
                <a href="../server-editing-api/editing_api_authentication.html">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.5" data-path="../server-editing-api/editing_api_design.html">
            
                <a href="../server-editing-api/editing_api_design.html">
            
                    
                    Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.6" data-path="../server-editing-api/editing_api_list.md">
            
                <span>
            
                    
                    Lists
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.7" data-path="../server-editing-api/editing_api_documents.html">
            
                <a href="../server-editing-api/editing_api_documents.html">
            
                    
                    Documents
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.8" data-path="../server-editing-api/editing_api_revisions.html">
            
                <a href="../server-editing-api/editing_api_revisions.html">
            
                    
                    Revisions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.9" data-path="../server-editing-api/editing_api_publications.html">
            
                <a href="../server-editing-api/editing_api_publications.html">
            
                    
                    Publications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.10" data-path="../server-editing-api/editing_api_users.html">
            
                <a href="../server-editing-api/editing_api_users.html">
            
                    
                    Users
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.11" data-path="../server-editing-api/editing_api_spaces.html">
            
                <a href="../server-editing-api/editing_api_spaces.html">
            
                    
                    Projects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2.1.12" data-path="../server-editing-api/editing_api_hooks.html">
            
                <a href="../server-editing-api/editing_api_hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../maintenance/release-management/">
            
                <a href="../maintenance/release-management/">
            
                    
                    Releases
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.3.1" data-path="../maintenance/release-management/deployment-pipeline.html">
            
                <a href="../maintenance/release-management/deployment-pipeline.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation" style="background-color: #3a2f3c; height: 50px; position: fixed; width: 83%">
    <a href="https://www.livingdocs.io"><img src="https://livingdocs.io/assets/images/livingdocs-logo-inverted.svg" style="width: 200px; padding: 15px 40px" /></a>
    

    <!-- Title -->
    <h1 style="position: absolute; top: 0; left: 30%; color: white">
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Routing system</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="routing-system">Routing System</h1>
<h2 id="use-case">Use case</h2>
<p>The Delivery <strong>app</strong> is asked to deliver a <strong>document</strong> located at a <strong>path</strong>. To resolve a path to a document, the delivery app uses the Routing system endpoint.</p>
<ol>
<li>Delivery <strong>app</strong> receives <code>GET /article/adventure/i-m-on-the-road-again-09fed8</code> on the <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a> <code>web</code></li>
<li>Delivery <strong>app</strong> calls public API of Delivery <strong>server</strong>: <code>GET https://delivery-server/api/routing/web?path=/article/adventure/i-m-on-the-road-again-09fed8</code></li>
<li><p>Delivery <strong>server</strong> response looks like:</p>
<pre><code class="lang-json"> [{
   <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
   <span class="hljs-string">&quot;resource&quot;</span>: {
     <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">173</span>,
     <span class="hljs-string">&quot;statusCode&quot;</span>: <span class="hljs-number">200</span>
   }
 }]
</code></pre>
</li>
<li><p>(Down the road, the delivery <strong>app</strong> will ask the delivery <strong>server</strong> for an HTML rendering of the latest publication of this document and serve it to the client)</p>
</li>
</ol>
<h2 id="architecture">Architecture</h2>
<p>The routing system is composed of three parts:</p>
<ol>
<li>The <em>routing metadata plugin</em>,</li>
<li>The <em>routes indexer</em>, and</li>
<li>The <em>routes cache</em>.</li>
</ol>
<p>Rough picture/story of how these components/concepts are tied together:</p>
<p>There is a document titled <em>I&apos;m on the road again!</em>, its documentId is <code>173</code>, it also has a custom publicId <code>09fed8</code>. It is an <em>article</em> in the <a href="../../GLOSSARY.html#project" class="glossary-term" title="Represents an organisation and consists of users and channels.">project</a> projectId <code>5</code>, filed in the category <em>adventure</em>.</p>
<p>The plugin&apos;s responsibility is to generate a path (<code>/article/adventure/i-m-on-the-road-again-09fed8</code>) and slugs (<code>i-m-on-the-road-again</code>) for a publication. The user hits &apos;publish&apos;, the routing plugin generates and writes the path and slug to the publication metadata. At the end of the &apos;publish&apos; call, a publication event is written to the database.</p>
<p>The routes indexer sees this new publication event. It first puts the routing information for this publication (found in the publication metadata which the <em>routing metadata plugin</em> wrote) in the <em>routes cache</em>: <code>&quot;doc:173&quot; =&gt; {path: &#x2026;, slug: &#x2026;, &#x2026;}</code>. The routes indexer, through another intervaled function, puts <code>&quot;path:5:/article/adventure/i-m-on-the-road-again-09fed8&quot; =&gt; {id: 173, resource: {status: 200, &#x2026;}, &#x2026;}</code> in the <em>routes cache</em>.</p>
<p>The Delivery <strong>app</strong> gets a GET request for <code>/article/adventure/i-m-on-the-road-again-09fed8</code>. It asks the Delivery <strong>server</strong>; its API does a lookup in the routes cache; this key being in the routes cache it directly returns the corresponding value, which are telling the Delivery <strong>app</strong> about which document this routes corresponds to, which is here the document <code>173</code>.</p>
<h3 id="routing-metadata-plugin">Routing Metadata Plugin</h3>
<p>Taking a look at our <a href="https://github.com/upfrontIO/livingdocs-server/blob/master/plugins/metadata/li-default-routing.js" target="_blank">routing metadata plugin example</a> should help you understand how to write your own.</p>
<p>This plugin is responsible for <strong>generating and writing</strong> routing data into a publication metadata. It should also export a function with the following signature <code>documentIdExtractor = (path) =&gt; documentId</code>.</p>
<p>It is based on the routing info found in each publication metadata that the <em>routes cache</em> will get populated with routes to documents. Therefore the <em>routing metadata plugin</em> hooks into documents <code>onPublish</code> and returns an object <code>{path, slug}</code> which gets written under the key <code>routing</code> in the publication metadata.</p>
<p>The <code>documentIdExtractor</code> function will be used in case an exact route match cannot be found. For instance if the cache has <code>/article/adventure/i-m-on-the-road-again-09fed8</code> but the incoming request is for <code>/article/adventure/im-on-the-road-again-09fed8</code> (notice the typo in the path!), the path will not be found in the <em>routes cache</em> and the routing system endpoint will resort to calling <code>documentIdExtractor(&apos;/article/adventure/i-m-on-the-road-again-09fed8&apos;)</code>, which could for example detect the presence of the public ID <code>09fed8</code> and return the corresponding <code>documentId</code> <code>173</code>. This way the routing system will still be able to respond to the Delivery <strong>app</strong>, which could in turn redirect its user to the correct path for this resource, <code>/article/adventure/i-m-on-the-road-again-09fed8</code>.</p>
<h3 id="routes-indexer">Routes Indexer</h3>
<p>The <em>routes indexer</em> is a procedure running at a configurable interval. It runs at most once per interval duration (i.e. if one iteration takes longer than the interval, the next iteration will only start as soon as the previous one is done, they cannot overlap).</p>
<p>The <em>routes indexer</em> watches the publication events, polling the database for events that happened after the last indexed event, <code>lastIndexedEvent</code> being a special key-value in the <em>routes cache</em>.</p>
<h4 id="start-up-warm-up">Start up, warm up</h4>
<p>When the server starts, if the <em>routes cache</em> is empty, the interval will be set to zero and the server will index all existing publication events as fast as it can.</p>
<p>Since the <em>routes cache</em> has <code>lastIndexedEvent</code> key, if the server reboots and the <em>routes cache</em> backend in use is persisted somewhere, the <em>routes indexer</em> will pick up where it left off instead of reindexing everything from the beginning.</p>
<h3 id="routes-cache">Routes Cache</h3>
<p>The <em>routes cache</em> is a key-value store interfaced using a leveldb API provided by <em>levelup</em>. It can be backed by any compatible engine. A few options include:</p>
<ul>
<li><a href="https://github.com/level/memdown" target="_blank"><em>memdown</em></a>, an in-memory KV store - we use it in our tests since we don&apos;t care about persisting the cache</li>
<li><a href="https://github.com/hmalphettes/redisdown" target="_blank"><em>redisdown</em></a>, which is a Redis backend - not recommended because untested yet, might create issues if you have several indexers running concurrently</li>
</ul>
<p>The <em>routes cache</em> has two keys per once-published document (i.e. not per publication but rather per document for which we got at least one publication event).</p>
<ol>
<li>A key associating a document <code>id</code> (keyed as <code>doc:&lt;documentId&gt;</code>) to some metadata about the corresponding document, most importantly its state (published, unpublished) and the metadata routing data, and</li>
<li>A key associating a path (keyed as <code>path:&lt;projectId&gt;:&lt;path&gt;</code>) to roughly an API response.</li>
</ol>
<h3 id="configuration">Configuration</h3>
<p>Routing configuration takes place on two levels:</p>
<ol>
<li>Environment - globally configure and enable the routing, and</li>
<li>Per document type per <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a> - enable routing for each document type for each <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a> you&apos;d like to route to.</li>
</ol>
<h4 id="environment">Environment</h4>
<p>In your environment configuration file (here, <code>local.coffee</code>), a top-level config key named <code>routing</code> is required, with the following possible keys:</p>
<pre><code class="lang-coffee">  routing:
    enabled: <span class="hljs-literal">false</span>
    db: <span class="hljs-string">&apos;redisdown&apos;</span> <span class="hljs-comment"># (default: memdown)</span>
    <span class="hljs-comment"># db_options: # (optional) cf. https://github.com/Level/levelup#options</span>
    redis: <span class="hljs-comment"># (optional)</span>
      master_check_interval: <span class="hljs-number">5000</span> <span class="hljs-comment"># (default: 5000) how often do we check if we&apos;re the master</span>
    indexing: <span class="hljs-comment"># (optional)</span>
      <span class="hljs-comment"># number of publication events to process in each batch</span>
      batch_size: <span class="hljs-number">50000</span> <span class="hljs-comment"># (default: 50000)</span>
      <span class="hljs-comment"># routes cache update interval</span>
      watch_interval: <span class="hljs-number">1000</span> <span class="hljs-comment"># (default: 1000)</span>
</code></pre>
<p>If not explicitly set to <code>enabled: true</code>, routing will be disabled.</p>
<h4 id="master-check">Master check</h4>
<p>In a setting with more than one Delivery <strong>server</strong> running against the same <em>routes cache</em>, we want to have at most one <em>routes indexer</em> running at any time. Having many of them trying to concurrently index the same publication events could create issues.</p>
<p>When using Redis, a Delivery <strong>server</strong> will either be the <em>master</em> and index the routes by running the <em>routes indexer</em> or not be the <em>master</em> and not index the routes by pausing the <em>routes indexer</em>.</p>
<p>When a <em>master</em> crashes or gets shut down, another node will get promoted <em>master</em>. Same goes when <em>master</em> gets too slow because of the load or any other issue: it will get demoted and another node will get promoted.</p>
<p><code>routing:redis:master_check_interval</code> is the interval at which a process checks whether they are master or not, and should or should not get demoted or promoted.</p>
<h4 id="document-types-per-channel">Document types per channel</h4>
<p>Metadata plugins are configured per document type per <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a>. If you would like to route to <code>articles</code> and <code>pages</code> in the <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a> <code>web</code>, you will have to set the following keys in the following files:</p>
<ul>
<li><p><code>conf/channels/web/articles.coffee</code>:</p>
<pre><code class="lang-coffee">  metadata:
    routing:
      plugin: <span class="hljs-string">&apos;li-default-routing&apos;</span>
</code></pre>
</li>
<li><p><code>conf/channels/web/pages.coffee</code>:</p>
<pre><code class="lang-coffee">  metadata:
    routing:
      plugin: <span class="hljs-string">&apos;li-default-routing&apos;</span>
</code></pre>
</li>
</ul>
<h4 id="routespath-customization">Routes/path customization</h4>
<p>Customizing the path generated for each publication is done via the <a href="#routing-metadata-plugin"><em>routing metadata plugin</em></a>.</p>
<h4 id="generating-routing-info-for-existing-publications">Generating routing info for existing publications</h4>
<p>Any document published prior to configuring the <em>routing metadata plugin</em> for their document type in their <a href="../../GLOSSARY.html#channel" class="glossary-term" title="Represents a collection of documents. All documents in a channel must use
the same design. A channel also defines the Renditions.">channel</a> will not possess any metadata routing info, therefore the indexer will not be able to take them into account.</p>
<p>If you already have published documents but their metadata don&apos;t have routing infos because the plugin wasn&apos;t there when they were published, the easiest fix is to republish these documents. No need to delete them and recreate them, republishing is enough to get the metadata up to date.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../server-extensions/publish-hooks.html" class="navigation navigation-prev " aria-label="Previous page: Publish and Unpublish Hooks">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../concepts/metadata/metadata-examples.html" class="navigation navigation-next " aria-label="Next page: Metadata Example (editor and server)">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Routing system","level":"3.3.7","depth":2,"next":{"title":"Metadata Example (editor and server)","level":"3.4","depth":1,"path":"concepts/metadata/metadata-examples.md","ref":"concepts/metadata/metadata-examples.md","articles":[]},"previous":{"title":"Publish and Unpublish Hooks","level":"3.3.6","depth":2,"path":"reference-docs/server-extensions/publish-hooks.md","ref":"reference-docs/server-extensions/publish-hooks.md","articles":[]},"dir":"ltr"},"config":{"plugins":["livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Livingdocs","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Livingdocs Technical Documentation","gitbook":"*","description":"Technical documentation of the Livingdocs CMS. Covers documentation for designers, integrators and core developers"},"file":{"path":"reference-docs/server-public-api/routing-system.md","mtime":"2017-08-14T13:11:48.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-08-15T12:39:59.671Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

